import os
import json
import pandas as pd

def extract_labels_from_json(json_path):
    with open(json_path, 'r') as file:
        data = json.load(file)
    
    labels = [shape['label'] for shape in data['shapes']]
    return labels

def create_dataframe_from_json_files(folder_path):
    all_files = os.listdir(folder_path)
    json_files = [f for f in all_files if f.endswith('.json')]
    
    # Set to store all unique labels
    unique_labels = set()

    # Dictionary to hold the count of each label for each file
    data_dict = {}

    for json_file in json_files:
        json_path = os.path.join(folder_path, json_file)
        labels = extract_labels_from_json(json_path)
        
        # Count labels in the current file
        label_count = {}
        for label in labels:
            if label not in unique_labels:
                unique_labels.add(label)
            label_count[label] = label_count.get(label, 0) + 1
        
        data_dict[json_file] = label_count

    # Create a DataFrame
    df = pd.DataFrame.from_dict(data_dict, orient='index').fillna(0)
    
    # Ensure all columns are present for all rows
    for label in unique_labels:
        if label not in df.columns:
            df[label] = 0

    # Reorder columns to have 'filename' as the first column
    df.index.name = 'filename'
    df.reset_index(inplace=True)

    return df

if __name__ == "__main__":
    folder_path = 'path_to_your_folder'  # Replace with the path to your folder
    df = create_dataframe_from_json_files(folder_path)
    print(df)
    df.to_csv('output.csv', index=False)  # Optionally save the dataframe to a CSV file
