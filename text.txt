import pandas as pd

def extract_and_transform_data(csv_path):
    # Read the CSV file into a DataFrame
    df = pd.read_csv(csv_path)
    
    # Define the columns to be extracted
    columns_to_extract = ['VIN']
    columns_to_extract += [f'A{i}' for i in range(1, 13)]
    columns_to_extract += [f'B{i}' for i in range(1, 13)]
    columns_to_extract += [f'C{i}' for i in range(1, 13)]
    
    # Extract the specified columns
    extracted_df = df[columns_to_extract]
    
    # Initialize the list for the new DataFrame rows
    new_rows = []
    
    # Iterate over each row in the extracted DataFrame
    for _, row in extracted_df.iterrows():
        vin = row['VIN']
        
        # Create rows for AngleA, AngleB, and AngleC
        angle_a_row = {'VIN judgements': f'{vin}_AngleA'}
        angle_b_row = {'VIN judgements': f'{vin}_AngleB'}
        angle_c_row = {'VIN judgements': f'{vin}_AngleC'}
        
        # Count the categories for AngleA, AngleB, and AngleC separately
        counts_a = {category: 0 for category in ['L', 'H', 'M', 'S', 'N', 'P']}
        counts_b = {category: 0 for category in ['L', 'H', 'M', 'S', 'N', 'P']}
        counts_c = {category: 0 for category in ['L', 'H', 'M', 'S', 'N', 'P']}
        
        for col in [f'A{i}' for i in range(1, 13)]:
            value = row[col]
            if value in counts_a:
                counts_a[value] += 1
        
        for col in [f'B{i}' for i in range(1, 13)]:
            value = row[col]
            if value in counts_b:
                counts_b[value] += 1
        
        for col in [f'C{i}' for i in range(1, 13)]:
            value = row[col]
            if value in counts_c:
                counts_c[value] += 1
        
        # Update the angle rows with the counts
        angle_a_row.update(counts_a)
        angle_b_row.update(counts_b)
        angle_c_row.update(counts_c)
        
        # Add values from A1 to A12, B1 to B12, and C1 to C12 respectively
        angle_a_row.update({col: row[col] for col in columns_to_extract if col.startswith('A')})
        angle_b_row.update({col: row[col] for col in columns_to_extract if col.startswith('B')})
        angle_c_row.update({col: row[col] for col in columns_to_extract if col.startswith('C')})
        
        new_rows.extend([angle_a_row, angle_b_row, angle_c_row])
    
    # Create a new DataFrame from the list of new rows
    new_df = pd.DataFrame(new_rows)
    
    return new_df

if __name__ == "__main__":
    csv_path = 'path_to_your_csv_file.csv'  # Replace with the path to your CSV file
    transformed_df = extract_and_transform_data(csv_path)
    print(transformed_df)
    transformed_df.to_csv('transformed_output.csv', index=False)  # Optionally save the new DataFrame to a CSV file
